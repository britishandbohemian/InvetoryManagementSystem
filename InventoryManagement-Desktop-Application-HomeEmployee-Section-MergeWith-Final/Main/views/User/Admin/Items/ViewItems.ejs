<!DOCTYPE html>
<html>

<head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="stylesheet" href="/css/style.css">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
      <!-- Bootstrap CSS -->
      <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">
      <link rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
      <link rel="stylesheet" href="/css/styles.css">



      <!-- Style -->
      <link rel="stylesheet" href="css/style.css">

      <title>View Items</title>

      <style>
            .modal {
                  display: none;
                  position: fixed;
                  top: 0;
                  left: 0;
                  width: 100%;
                  height: 100%;
                  background-color: rgba(0, 0, 0, 0.7);
                  z-index: 999;
            }

            .custom-table-responsive {
                  margin: 2rem;
                  background-color: white !important;
                  padding: 20px;
                  border-radius: 15px;
            }

            #popupFormComponent {
                  display: none;
                  /* Initially hide the popup */
                  position: fixed;
                  /* Fixed position */
                  left: 0;
                  top: 0;
                  width: 100%;
                  /* Full width */
                  height: 100%;
                  /* Full height */
                  overflow: auto;
                  /* Enable scroll if needed */
                  background-color: rgba(0, 0, 0, 0.4);
                  /* Black w/ opacity */
            }

            .form-container {
                  background-color: #ffffff;
                  margin: 1rem auto;
                  /* 15% from the top and centered */
                  padding: 20px;
                  border: 1px solid #888;
                  width: 50%;
                  /* Could be more or less, depending on screen size */
                  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
                  transition: 0.3s;
            }

            #searchbar {
                  position: fixed;
                  width: 100%;
                  z-index: 2;
                  background-color: #fcfcfc;
                  height: 11vh;
                  display: grid;
                  grid-template-columns: 60% 1fr;
                  align-items: center;
                  flex-direction: row;
                  justify-content: left;
                  padding-right: 4rem;
                  border: 1px solid 1px solid rgb(230 230 230);
            }

            #searchbarInput {
                  text-align: center;
                  font-size: 0.8em;
                  width: 100%;
                  height: 2.3rem;
                  background-color: #ececec;
                  border: 1px #cfcfcf solid;
                  border-radius: 24px;
                  padding-left: 2.5rem;
            }

            .invalid-input {
                  border-bottom: 2px solid red;
            }
      </style>


</head>

<body>

      <%- include('../NavbarAdmin') %>

            <!-- Main Content -->
            <div class="main-content">


                  <!-- Search Bar -->
                  <div class="shadowNav" id="searchbar">
                        <h6 style="   font-weight: 800;
      font-size: 1.5em;
      padding-left: 5rem;">Items

                        </h6>

                        <div style="display: flex;width: 100%;justify-content: right;">


                              <div style="position: relative; width: 20vw; margin-right: 24rem;">
                                    <input class="shadowNav" id="searchbarInput" type="text"
                                          placeholder="Search Inventory">
                                    <i style="position: absolute; 
                      left: 1rem; 
                      top: 0.5rem; 
                      font-size: 0.8em;
                      color: rgb(158, 158, 158);" class="search-icon"><span style="font-size: 1.5em;"
                                                class="material-symbols-outlined">
                                                search
                                          </span></i>
                              </div>



                        </div>

                  </div>
                  <section style="margin-top:6rem; padding:  7rem 5rem;">


                        <div style="margin-left: 1rem;    background: linear-gradient(to right, #1a2a6c, #b21f1f, #fdbb2d);
                              border: 1px solid rgb(216, 216, 216);
                              width: 300px;
                              border-radius: 15px;
                              height: 300px;
                              display: grid;
                              grid-template-rows: 33% 1fr 33%;
                              padding-top: 1rem;
                              padding-left: 2rem;
                              align-items: left;
                              ">
                              <span style="color: white;" class="material-symbols-outlined">
                                    savings
                              </span>
                              <H3 style="color: white;font-size: 1.5rem;">Potential Profit Loss , Today</H3>
                              <h4 style="color: white;">
                                    R 10000
                              </h4>
                        </div>

                        <div
                              style="background-color: white;border-radius: 15px;border:  1px solid rgb(216, 216, 216);margin-bottom: 1REM;margin-top: 7rem;margin: 7rem auto;">

                              <div style="padding: 1rem;padding-left: 5.5rem;padding-top: 3rem;">
                                    <h3 style="font-weight: bold;font-size: 1.5rem;">Items that are Performing well and
                                          running low
                                    </h3>
                                    <h5 style="font-size: 1rem;font-weight: 400;margin-top: 20px;">It Is
                                          recommended you
                                          reorder them to avoid
                                          a shortage</h5>
                              </div>



                              <hr>


                              <div style="margin-top:1rem ;width: fit-content;" id="myTable" class="">
                                    <div class="table-responsive custom-table-responsive">
                                          <table class="table custom-table">
                                                <thead>
                                                      <tr>
                                                            <th scope="col">
                                                                  <label class="control control--checkbox">
                                                                  </label>
                                                            </th>
                                                            <th scope="col">Action</th>
                                                            <th scope="col">Component Name</th>
                                                            <th scope="col">Quanity</th>
                                                            <th scope="col">Cost Price Per Unit</th>
                                                      </tr>
                                                </thead>
                                                <tbody>
                                                      <% Components.forEach(Component=> { %>
                                                            <tr scope="row">
                                                                  <th scope="row">
                                                                        <label class="control control--checkbox">
                                                                              <input type="checkbox" />
                                                                              <div class="control__indicator">
                                                                              </div>
                                                                        </label>
                                                                  </th>
                                                                  <td style="display: flex;gap: 1rem;">
                                                                        <a style="display: flex;align-items: center;"
                                                                              href="/EditComponent/<%=Component.ItemId %>"><span
                                                                                    class="material-symbols-outlined">
                                                                                    edit
                                                                              </span></a>
                                                                        |
                                                                        <button
                                                                              style="border: none;background-color: transparent;display: flex;align-items: center;"
                                                                              onclick="deleteSupplier(<%= Component.ItemId %>)"><span
                                                                                    class="material-symbols-outlined">
                                                                                    delete
                                                                              </span></button>
                                                                  </td>
                                                                  <td>
                                                                        <%= Component.itemName %>
                                                                  </td>
                                                                  <td>
                                                                        <%= Component.unitsInInventory %>
                                                                  </td>
                                                                  <td>
                                                                        R <%= Component.pricePerPiece %>
                                                                  </td>
                                                                  <td>

                                                            </tr>
                                                            <tr class="spacer">
                                                                  <td colspan="100"></td>
                                                            </tr>
                                                            <% }); %>
                                                </tbody>
                                          </table>
                                    </div>
                              </div>



                        </div>

                        <div style="margin-left: 1rem;   background: linear-gradient(to right, #1a2a6c, #b21f1f, #fdbb2d);
        
                              width: 300px;
                              border-radius: 15px;
                              height: 300px;
                              display: grid;
                              grid-template-rows: 33% 33% 33%;
                              padding-top: 1rem;
                              justify-content: center;
                              align-items: left;
                              ">
                              <span style="color: white;" class="material-symbols-outlined">
                                    savings
                              </span>
                              <H3 style="color: white;font-size: 1.5rem;">Reorder Cost</H3>
                              <h4 style="color: white;">
                                    R 10000
                              </h4>
                        </div>

                        <div
                              style="background-color: white;border-radius: 15px;border:  1px solid rgb(216, 216, 216);margin-bottom: 1REM;margin-top: 7rem;margin: 7rem auto;">

                              <div style="padding: 1rem;padding-left: 5.5rem;padding-top: 3rem;">
                                    <h3 style="font-weight: bold;font-size: 1.5rem;">All Items that are running Low
                                    </h3>
                                    <h5 style="font-size: 1rem;font-weight: 400;margin-top: 20px;">It Is
                                          recommended you
                                          reorder them to avoid
                                          a shortage</h5>
                              </div>



                              <hr>


                              <div style="margin-top:1rem ;width: fit-content;" id="myTable" class="">
                                    <div class="table-responsive custom-table-responsive">
                                          <table class="table custom-table">
                                                <thead>
                                                      <tr>
                                                            <th scope="col">
                                                                  <label class="control control--checkbox">
                                                                  </label>
                                                            </th>
                                                            <th scope="col">Action</th>
                                                            <th scope="col">Component Name</th>
                                                            <th scope="col">Component Quanity (KG/L)</th>
                                                            <th scope="col">Cost Price Per Unit (KG/L)</th>
                                                      </tr>
                                                </thead>
                                                <tbody>
                                                      <% ItemsRunningLow.forEach(Component=> { %>
                                                            <tr scope="row">
                                                                  <th scope="row">
                                                                        <label class="control control--checkbox">
                                                                              <input type="checkbox" />
                                                                              <div class="control__indicator">
                                                                              </div>
                                                                        </label>
                                                                  </th>
                                                                  <td style="display: flex;gap: 1rem;">
                                                                        <a style="display: flex;align-items: center;"
                                                                              href="/EditComponent/<%=Component.ItemId %>"><span
                                                                                    class="material-symbols-outlined">
                                                                                    edit
                                                                              </span></a>
                                                                        |
                                                                        <button
                                                                              style="border: none;background-color: transparent;display: flex;align-items: center;"
                                                                              onclick="deleteSupplier(<%= Component.ItemId %>)"><span
                                                                                    class="material-symbols-outlined">
                                                                                    delete
                                                                              </span></button>
                                                                  </td>
                                                                  <td>
                                                                        <%= Component.itemName %>
                                                                  </td>
                                                                  <td>
                                                                        <%= Component.totalPiecesInInventory %>
                                                                  </td>
                                                                  <td>
                                                                        R <%= Component.pricePerPiece %>
                                                                  </td>
                                                                  <td>

                                                            </tr>
                                                            <tr class="spacer">
                                                                  <td colspan="100"></td>
                                                            </tr>
                                                            <% }); %>
                                                </tbody>
                                          </table>
                                    </div>
                              </div>



                        </div>


                        <div style="margin-left: 1rem;  background: linear-gradient(to right, #1a2a6c, #b21f1f, #fdbb2d);
                        border: 1px solid rgb(216, 216, 216);
                        width: 300px;
                        border-radius: 15px;
                        height: 300px;
                        display: grid;
                        grid-template-rows: 33% 33% 33%;
                        padding-top: 1rem;
                        padding-left: 2rem;
                        align-items: left;
                        ">
                              <span style="color: white;" class="material-symbols-outlined">
                                    savings
                              </span>
                              <H3 style="color: white;font-size: 1.5rem;">Worth</H3>
                              <h4 style="color: white;">
                                    R 10000
                              </h4>
                        </div>



                        <div
                              style="background-color: white;border-radius: 15px;border:  1px solid rgb(216, 216, 216);margin-bottom: 1REM;margin-top: 7rem;margin: 7rem auto;">


                              <div style="padding: 1rem;padding-left: 5.5rem;padding-top: 3rem;">
                                    <h3 style="font-weight: bold;font-size: 1.5rem;">All Your Items
                                    </h3>
                                    <h5 style="font-size: 1rem;font-weight: 400;margin-top: 20px;">Overview Of All your
                                          items</h5>
                              </div>



                              <hr>




                              <div style="margin-top:1rem ;width: fit-content;" id="myTable" class="">
                                    <div class="table-responsive custom-table-responsive">
                                          <table class="table custom-table">
                                                <thead>
                                                      <tr>
                                                            <th scope="col">
                                                                  <label class="control control--checkbox">
                                                                  </label>
                                                            </th>
                                                            <th scope="col">Action</th>
                                                            <th scope="col">Component Name</th>
                                                            <th scope="col">Component Quanity (KG/L)</th>
                                                            <th scope="col">Cost Price Per Unit (KG/L)</th>
                                                      </tr>
                                                </thead>
                                                <tbody>
                                                      <% Components.forEach(Component=> { %>
                                                            <tr scope="row">
                                                                  <th scope="row">
                                                                        <label class="control control--checkbox">
                                                                              <input type="checkbox" />
                                                                              <div class="control__indicator">
                                                                              </div>
                                                                        </label>
                                                                  </th>
                                                                  <td style="display: flex;gap: 1rem;">
                                                                        <a style="display: flex;align-items: center;"
                                                                              href="/EditComponent/<%=Component.ItemId %>"><span
                                                                                    class="material-symbols-outlined">
                                                                                    edit
                                                                              </span></a>
                                                                        |
                                                                        <button
                                                                              style="border: none;background-color: transparent;display: flex;align-items: center;"
                                                                              onclick="deleteSupplier(<%= Component.ItemId %>)"><span
                                                                                    class="material-symbols-outlined">
                                                                                    delete
                                                                              </span></button>
                                                                  </td>
                                                                  <td>
                                                                        <%= Component.itemName %>
                                                                  </td>
                                                                  <td>
                                                                        <%= Component.totalPiecesInInventory %>
                                                                  </td>
                                                                  <td>
                                                                        R <%= Component.pricePerPiece %>
                                                                  </td>
                                                                  <td>

                                                            </tr>
                                                            <tr class="spacer">
                                                                  <td colspan="100"></td>
                                                            </tr>
                                                            <% }); %>
                                                </tbody>
                                          </table>
                                    </div>
                              </div>



                        </div>




                  </section>

            </div>

            <!-- Add Component -->
            <div id="popupFormComponent">
                  <div class="form-container"
                        style="margin-top: 20vh;border-radius: 10px;margin-left: 35vw;width: 40vw;">
                        <form id="ComponentForm" method="post" style="">
                              <label for="componentName">Component Name:</label>
                              <input class="form-control" type="text" id="componentName" name="componentName"
                                    required><br><br>

                              <label for="componentDescription">Component Description:</label>
                              <textarea class="form-control" id="componentDescription" name="componentDescription"
                                    required></textarea><br><br>

                              <label for="unitOfMeasurement">Unit of Measurement:</label>
                              <select class="form-control" id="unitOfMeasurement" name="unitOfMeasurement" required>
                                    <option value="0">Unit</option>
                                    <option value="1">Kilogram</option>
                                    <option value="2">Liter</option>
                                    <option value="3">Grams</option>
                              </select><br><br>



                              <label for="minimumThreshold">Minimum Threshold:</label>
                              <input class="form-control" type="number" id="minimumThreshold" name="minimumThreshold"
                                    required><br><br>

                              <label for="maximumThreshold">Maximum Threshold:</label>
                              <input class="form-control" type="number" id="maximumThreshold" name="maximumThreshold"
                                    required><br>


                              <br>

                              <label for="category">Select A Category:</label>
                              <select class="form-control" name="category" id="category">
                                    <% Categories.forEach(category=> { %>
                                          <option value="<%= category.categoryId %>">
                                                <%= category.categoryName %>
                                          </option>
                                          <% }) %>
                              </select>

                              <br>
                              <input class="btn" type="submit" value="Add Component">
                        </form>
                  </div>
            </div>


            <!-- Floating Bar  -->
            <div class="floating-btn-container">
                  <a id="showFormCompomentBtn" class="floating-btn"
                        style=" background: linear-gradient(to right, #1a2a6c, #b21f1f, #fdbb2d);"
                        onclick="OpenModal()">
                        <i class="material-icons"> add</i>
                  </a>
            </div>



            <script>


                  document.getElementById("ComponentForm").addEventListener("submit", function (event) {
                        var minThreshold = document.getElementById("minimumThreshold").value;
                        var maxThreshold = document.getElementById("maximumThreshold").value;

                        if (parseInt(maxThreshold) <= parseInt(minThreshold)) {
                              alert("The maximum threshold must be greater than the minimum threshold!");
                              event.preventDefault(); // Prevent form submission
                        }
                  });


                  // Calls To Index To Add Item
                  function submitComponentForm() {
                        event.preventDefault();


                        let form = document.getElementById("ComponentForm")
                        // Create the component model
                        const componentModel = {
                              componentName: form.componentName.value,
                              componentDescription: form.componentDescription.value,
                              costPerUnit: parseInt(form.costPricePerUnit.value),
                              unitOfMeasurement: parseInt(form.unitOfMeasurement.value),
                              sellByDate: form.sellByDate.value,
                              minimumThreshold: parseInt(form.minimumThreshold.value),
                              maximumThreshold: parseInt(form.maximumThreshold.value),
                              purchasePrice: parseFloat(form.purchasePrice.value),
                              supplierId: parseInt(form.supplier.value),
                              categoryId: parseInt(form.category.value),
                        };

                        // Use the Fetch API to send the component model
                        fetch('/api/CreateComponent', {
                              method: 'POST',
                              headers: {
                                    'Content-Type': 'application/json',
                              },
                              body: JSON.stringify(componentModel)
                        })
                              .then(response => {
                                    if (!response.ok) {
                                          throw new Error('Network response was not ok');
                                    }
                                    return response.json();
                              })
                              .then(data => {

                                    // Close the form
                                    closeFormComponent();
                                    window.location.reload();
                                    window.location.reload();
                              })
                              .catch(error => {
                                    // Handle errors here
                                    console.error('There was an error adding the component:', error);
                              });
                  }


                  // Show Component Form
                  document.getElementById('showFormCompomentBtn').addEventListener('click', function () {
                        document.getElementById('popupFormComponent').style.display = 'block';
                  });

                  // Close Component Form
                  function closeFormComponent() {
                        document.getElementById('popupFormComponent').style.display = 'none';
                  }


                  // Close the modal if clicked outside
                  window.onclick = function (event) {
                        if (event.target === modal) {
                              modal.style.display = 'none';
                        }
                  }

                  let modal = document.getElementById('popupFormComponent');



                  function validateAndHighlightFields() {
                        let hasInvalidFields = false;
                        const requiredFields = document.querySelectorAll('#ComponentForm [required]');

                        requiredFields.forEach(field => {
                              if (!field.value.trim()) {
                                    field.classList.add('invalid-input');
                                    hasInvalidFields = true;
                              } else {
                                    field.classList.remove('invalid-input');
                              }
                        });

                        return !hasInvalidFields; // Return true if all fields are valid
                  }

                  function submitComponentForm() {
                        if (validateAndHighlightFields()) {
                              document.getElementById("ComponentForm").submit();
                        }
                  }

                  document.addEventListener("DOMContentLoaded", function () {
                        const requiredFields = document.querySelectorAll('#ComponentForm [required]');
                        requiredFields.forEach(field => {
                              field.addEventListener('focus', () => {
                                    field.classList.remove('invalid-input');
                              });
                        });
                  });

            </script>




</body>

</html>