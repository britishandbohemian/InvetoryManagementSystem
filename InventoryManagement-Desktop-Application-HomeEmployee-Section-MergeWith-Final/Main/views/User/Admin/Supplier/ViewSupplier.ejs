<!DOCTYPE html>
<html lang="en">
<!-- Ignore This Styling -->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.7">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />

    <link rel="stylesheet" href="/css/styles.css">


    <title>View Supplier</title>

    <STYle>
        #searchbar {
            position: fixed;
            width: 100%;
            z-index: 2;
            background-color: #fcfcfc;
            height: 15vh;
            display: grid;
            grid-template-columns: 60% 1fr;
            align-items: center;
            flex-direction: row;
            justify-content: left;
            padding-right: 4rem;
            border: 1px solid 1px solid rgb(230 230 230);
        }

        #searchbarInput {
            text-align: center;
            font-size: 0.8em;
            width: 100%;
            height: 2.3rem;
            background-color: #ececec;
            border: 1px #cfcfcf solid;
            border-radius: 24px;
            padding-left: 2.5rem;
        }
    </STYle>

</head>

<body>


    <%- include('../NavbarAdmin') %>


        <!-- Search Bar -->
        <div class="shadowNav" id="searchbar">
            <h6 style="   font-weight: 800;
      font-size: 1.5em;
      padding-left: 5rem;">Items

            </h6>

            <div style="display: flex;width: 100%;justify-content: right;">


                <div style="position: relative; width: 20vw; margin-right: 24rem;">
                    <input class="shadowNav" id="searchbarInput" type="text" placeholder="Search Inventory">
                    <i style="position: absolute; 
                      left: 1rem; 
                      top: 0.5rem; 
                      font-size: 0.8em;
                      color: rgb(158, 158, 158);" class="search-icon"><span style="font-size: 1.5em;"
                            class="material-symbols-outlined">
                            search
                        </span></i>
                </div>



            </div>

        </div>

        <!-- Where all my content is -->
        <div class="main-content">

            <!-- Header For Page -->

            <!-- Division Holding Content -->
            <div
                style="display: flex;justify-content: center;flex-direction: column;padding: 1.8rem; display: flex;justify-content: center;padding-left: 2.4rem;">



                <div
                    style="border-radius: 15pxs;width: 100%;      height: 300px;background-color:#f15e47; display: flex;justify-content: center;flex-direction: column;align-items: center;padding-left: 2.4rem;">
                    <span class="material-symbols-outlined" style="color: white;font-size: 3rem;">
                        warehouse
                    </span>
                    <div style="text-align: center;">
                        <p id="supplierName" style="color: white;font-size: 1.5rem;font-weight: 500;">
                            <%= Supplier.supplierName %>
                        </p>

                        <p id="contactInfo" style="color: white;font-size: 1rem;font-weight: 500;">
                            <%= Supplier.contactInfo %>
                        </p>

                        <p id="address" style="color: white;font-size: 0.9rem;font-weight: 500;">
                            <%= Supplier.address %>
                        </p>
                    </div>

                </div>



                <div class="shadow"
                    style="border-radius: 15px;border:  1px solid rgb(216, 216, 216);padding-bottom: 2rem;margin-top: 3rem; margin-bottom: 2rem ; display: flex; gap: 2rem;border-radius: 15px;">
                    <h2 class="headerPageTwo " style=" margin-bottom: 2rem ;width: 60%;" class="">
                        Products Ordered</h2>

                </div>

                <!-- rest of the HTML -->





                <!-- Categories In the Database -->
                <div class="shadow"
                    style="border-radius: 15px;border: 1px solid rgb(231, 231, 231);padding-bottom: 2rem;display: flex;width: 50%;justify-content: center;background-color: white;">


                    <div style="width: 90%;">

                        <!-- Product Cards with category -->
                        <div>
                            <h1 class=""
                                style="font-size: 1.5rem;font-weight: bold;padding-left: 2rem;margin-top: 2rem;margin-bottom: 0rem;">
                                Update
                                Supplier</h1>
                            <form style="padding: 1rem 2rem;" id="supplierForm" method="POST">
                                <br>
                                <br>
                                <label class="label" for="supplierName">Supplier Name:</label><br>
                                <input class="form-control" type="text" id="supplierName" name="supplierName"><br>

                                <label class="label" for="contactInfo">Email Address Info:</label><br>
                                <input class="form-control" type="text" id="emailAddress" name="emailAddress"><br>

                                <label class="label" for="contactInfo">Phone Number :</label><br>
                                <input class="form-control" type="text" id="phoneNumber" name="phoneNumber"><br>

                                <label class="label" for="contactInfo">Contact person:</label><br>
                                <input class="form-control" type="text" id="contactPerson" name="contactPerson"><br>

                                <label class="label" for="address">Address:</label><br>
                                <input class="form-control" type="text" id="address" name="address"><br>

                                <label class="label" for="address">Rating:</label><br>
                                <input class="form-control" type="text" id="rating" name="rating"><br>
                                <input style="" class="btn" type="submit" value="Update Information ">


                            </form>
                        </div>

                    </div>



                </div>

            </div>


            <div id="myModal" class="modal">
                <div class="modal-content">
                    <span class="close-btn">&times;</span>
                    <p>Product Ordered Succesfully</p>
                </div>
            </div>

        </div>

        <!-- MY SCRIPT -->
        <script>
            function OrderProduct(productId, supplierId, productSKU, costPrice, productLeadTime) {
                var quantityOrdered = document.getElementById("Quantity" + productId).value;

                const product = {
                    productId: productId,
                    supplierId: supplierId,
                    skuId: productSKU,
                    quantityOrdered: quantityOrdered,
                    costPerUnit: costPrice,
                    leadTime: productLeadTime
                }

                fetch(`/api/supplierOrder/${supplierId}/product`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(product),
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Success:', data);
                        OpenModal();
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });
            }


            function deleteProductFromSupplierWeb(supplierId, productId) {
                const url = `/api/Supplier/${supplierId}/products/${productId}`;

                fetch(url, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();  // If you expect a JSON response, even for DELETE
                    })
                    .then(data => {
                        if (data.success) {
                            console.log(data.message);
                            location.reload();  // Reload the page
                        } else {
                            console.error(data.message);
                            // Optionally show an error message to the user
                        }
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });


            }



            let modal = document.getElementById('myModal');
            let btn = document.getElementById('openModalBtn');
            let span = document.getElementsByClassName('close-btn')[0];

            // Open the modal
            function OpenModal() {
                modal.style.display = 'block';
            }

            // Close the modal
            span.onclick = function () {
                modal.style.display = 'none';
            }

            // Close the modal if clicked outside
            window.onclick = function (event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            }


            function handleSubmit(event) {
                event.preventDefault(); // Prevent default form submission

                // Collect form data
                const formData = new FormData(document.getElementById('supplierForm'));

                // Fetch API to send form data
                fetch(`/UpdateSupplier/<%=Supplier.supplierId %>`, {
                    method: 'POST',
                    body: formData
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) { // Check if response is successful
                            // Display a modal with success message
                            alert('Success!'); // You can replace this with your modal implementation
                        } else {
                            alert('Failed to update. Please try again.');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('An error occurred. Please try again.');
                    });
            }

            // Attach the event listener to the form
            document.getElementById('supplierForm').addEventListener('submit', handleSubmit);
        </script>

</body>

</html>